<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SJ íŒŒíŠ¸ë„ˆìŠ¤ ëª°</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ì‚¬ì¥ë‹˜ì˜ íŒŒì´ì–´ë² ì´ìŠ¤ ì„¤ì •ê°’
        const firebaseConfig = {
            apiKey: "AIzaSyCpFn2uM7Dibf9UpWZdSVOxOqcYceZwUtI",
            authDomain: "sj-innovation-a8f6b.firebaseapp.com",
            projectId: "sj-innovation-a8f6b",
            storageBucket: "sj-innovation-a8f6b.firebasestorage.app",
            messagingSenderId: "449389360798",
            appId: "1:449389360798:web:d1b490aa9c75807903ed8f",
            measurementId: "G-NED86350PH"
        };

        // íŒŒì´ì–´ë² ì´ìŠ¤ ì´ˆê¸°í™”
        try {
            const app = initializeApp(firebaseConfig);
            window.auth = getAuth(app);
            window.createUser = createUserWithEmailAndPassword;
            window.signInUser = signInWithEmailAndPassword;
            window.logOut = signOut;
            console.log("Firebase initialized successfully");
        } catch (e) {
            console.error("Firebase Init Error:", e);
            alert("ë¡œê·¸ì¸ ì‹œìŠ¤í…œ ì—°ê²° ì‹¤íŒ¨: " + e.message);
        }
    </script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const Icon = ({ name, ...props }) => {
            const iconName = name.charAt(0).toLowerCase() + name.slice(1);
            return <i data-lucide={iconName} {...props}></i>;
        };

        // --- ë°ì´í„° ---
        const CATEGORIES = ["ì „ì²´", "ìœ ì•„ë™ì˜ë¥˜", "ì™„êµ¬/êµêµ¬", "ì£¼ë°©/ì‹ê¸°", "ìƒí™œ/ê±´ê°•"];
        const PRODUCTS = [
            { id: 1, name: "ìºì¹˜í‹°ë‹ˆí•‘ í•˜ì¸„í•‘ ë°©í•œìš©í’ˆ ëª¨ìŒì „ (ì¥ê°‘/ëª©ë„ë¦¬)", category: "ìœ ì•„ë™ì˜ë¥˜", price: 11900, originPrice: 23000, rating: 4.9, image: "ğŸ§£", description: "ê²¨ìš¸ ì‹œì¦Œ í•„ìˆ˜ ì•„ì´í…œ! ì•„ì´ë“¤ì´ ì¢‹ì•„í•˜ëŠ” í•˜ì¸„í•‘ ìºë¦­í„°ê°€ ê·¸ë ¤ì§„ ë”°ëœ»í•œ ë°©í•œ ì¥ê°‘ê³¼ ëª©ë„ë¦¬ ì„¸íŠ¸ì…ë‹ˆë‹¤." },
            { id: 2, name: "í‹°ë‹ˆí•‘ ë§ˆìŠ¤í¬ ì‹œì¦Œ3 ìƒˆë¶€ë¦¬í˜• ì†Œí˜• (20ë§¤)", category: "ìƒí™œ/ê±´ê°•", price: 12900, originPrice: 15900, rating: 4.8, image: "ğŸ˜·", description: "ìˆ¨ì‰¬ê¸° í¸í•œ ìƒˆë¶€ë¦¬í˜• êµ¬ì¡°ì˜ ì–´ë¦°ì´ìš© ë§ˆìŠ¤í¬ì…ë‹ˆë‹¤." },
            { id: 3, name: "ìŠˆíŒ…ìŠ¤íƒ€ ìºì¹˜í‹°ë‹ˆí•‘ ì‹œì¦Œ5 í•˜ì¸„í•‘ ìœ ì•„ í„¸ëª©ë„ë¦¬", category: "ìœ ì•„ë™ì˜ë¥˜", price: 12900, originPrice: 21900, rating: 4.9, image: "ğŸ§£", description: "í¬ê·¼í•œ ê°ì´‰ì˜ ìœ ì•„ìš© í„¸ëª©ë„ë¦¬ì…ë‹ˆë‹¤." },
            { id: 4, name: "ìŠˆíŒ…ìŠ¤íƒ€ ìºì¹˜í‹°ë‹ˆí•‘ íŒ¨ë”© ë²™ì–´ë¦¬ ì¥ê°‘", category: "ìœ ì•„ë™ì˜ë¥˜", price: 22900, originPrice: 32900, rating: 4.7, image: "ğŸ§¤", description: "ë°©ìˆ˜ ê¸°ëŠ¥ì´ ìˆëŠ” íŒ¨ë”© ì†Œì¬ì˜ ë²™ì–´ë¦¬ ì¥ê°‘ì…ë‹ˆë‹¤." },
            { id: 5, name: "ìŠˆíŒ…ìŠ¤íƒ€ ìºì¹˜í‹°ë‹ˆí•‘ ëª¨ìëª©ë„ë¦¬ ì„¸íŠ¸", category: "ìœ ì•„ë™ì˜ë¥˜", price: 16900, originPrice: 29900, rating: 5.0, image: "ğŸ§¢", description: "ëª¨ìì™€ ëª©ë„ë¦¬ê°€ í•˜ë‚˜ë¡œ! ê·€ê¹Œì§€ ë”°ëœ»í•˜ê²Œ ë®ì–´ì£¼ëŠ” ì¼ì²´í˜• ë°©í•œ ëª¨ìì…ë‹ˆë‹¤." },
            { id: 6, name: "ì´íƒˆë¦¬ì•ˆ ë¸Œë ˆì¸ë¡¯ ëœë¤ ë”±ì§€ (25íŒ©)", category: "ì™„êµ¬/êµêµ¬", price: 22900, originPrice: 39900, rating: 4.8, image: "ğŸ²", description: "ìš”ì¦˜ ì´ˆë“±í•™ìƒë“¤ ì‚¬ì´ì—ì„œ ëŒ€ìœ í–‰! ë‹¤ì–‘í•œ ìºë¦­í„° ë”±ì§€ë¥¼ ëª¨ì„ ìˆ˜ ìˆëŠ” ëœë¤ íŒ© ì„¸íŠ¸ì…ë‹ˆë‹¤." },
            { id: 7, name: "ìŠˆíŒ…ìŠ¤íƒ€ ìºì¹˜í‹°ë‹ˆí•‘ ì‹œì¦Œ5 ìì„ ê¸€ì í•œê¸€í”ŒëŸ¬ìŠ¤", category: "ì™„êµ¬/êµêµ¬", price: 39900, originPrice: 49900, rating: 4.9, image: "ğŸ§²", description: "ë†€ë©´ì„œ ë°°ìš°ëŠ” í•œê¸€ ê³µë¶€! ìì„ êµêµ¬ ì„¸íŠ¸ì…ë‹ˆë‹¤." },
            { id: 8, name: "ìºì¹˜í‹°ë‹ˆí•‘ ì˜¬ì¸ì› êµì • ì “ê°€ë½ ìŠ¤í‘¼ í¬í¬ ì„¸íŠ¸", category: "ì£¼ë°©/ì‹ê¸°", price: 13900, originPrice: 17500, rating: 4.8, image: "ğŸ¥¢", description: "ì˜¬ë°”ë¥¸ ì “ê°€ë½ì§ˆ ìŠµê´€ì„ ê¸¸ëŸ¬ì£¼ëŠ” êµì • ì “ê°€ë½ê³¼ ìŠ¤í‘¼, í¬í¬, ì¼€ì´ìŠ¤ ì„¸íŠ¸ì…ë‹ˆë‹¤." },
            { id: 9, name: "ìŠˆíŒ…ìŠ¤íƒ€ ìºì¹˜í‹°ë‹ˆí•‘ ë…¼ìŠ¬ë¦½ ìŠ¤í…ì»µ (ì™•ìí•‘)", category: "ì£¼ë°©/ì‹ê¸°", price: 9900, originPrice: 15000, rating: 4.7, image: "ğŸ¥›", description: "ë°”ë‹¥ì— ë¯¸ë„ëŸ¼ ë°©ì§€ ì²˜ë¦¬ê°€ ë˜ì–´ ìˆì–´ ìŸì„ ê±±ì •ì´ ì ì€ ìŠ¤í…Œì¸ë¦¬ìŠ¤ ì»µì…ë‹ˆë‹¤." },
            { id: 10, name: "ìœ„ì‹œìº£ ìœ ì•„ ì–´ë¦°ì´ ì•ˆì‹¬ë½ ìŠ¤íŠ¸ë© ë³´í‹€", category: "ì£¼ë°©/ì‹ê¸°", price: 8900, originPrice: 12500, rating: 4.6, image: "ğŸ¼", description: "ì›í„°ì¹˜ ì˜¤í”ˆ ë°©ì‹ê³¼ ì ê¸ˆ ì¥ì¹˜(ì•ˆì‹¬ë½)ê°€ ìˆëŠ” ìœ ì•„ìš© ë¬¼ë³‘ì…ë‹ˆë‹¤." },
            { id: 11, name: "ìƒˆì½¤ë‹¬ì½¤ ìºì¹˜í‹°ë‹ˆí•‘ ì‹œì¦Œ4 í”Œë ˆì´íŒ… ìì„ ì†Œê¿‰ë†€ì´", category: "ì™„êµ¬/êµêµ¬", price: 23500, originPrice: 27000, rating: 4.8, image: "ğŸ°", description: "ì˜ˆìœ ë””ì €íŠ¸ë¥¼ ìì„ìœ¼ë¡œ ë¶™ì˜€ë‹¤ ë–¼ì—ˆë‹¤ í•  ìˆ˜ ìˆëŠ” ì†Œê¿‰ë†€ì´ ì„¸íŠ¸ì…ë‹ˆë‹¤." },
            { id: 12, name: "ì•„ì‚°ì œì•½ hCG ì„ì‹ í…ŒìŠ¤íŠ¸ê¸° ì§„ë‹¨ í‚¤íŠ¸ (25íšŒë¶„)", category: "ìƒí™œ/ê±´ê°•", price: 23900, originPrice: 47000, rating: 4.9, image: "âš•ï¸", description: "ì •í™•ë„ê°€ ë†’ê³  ì‚¬ìš©ì´ ê°„í¸í•œ ì„ì‹  ì§„ë‹¨ í‚¤íŠ¸ì…ë‹ˆë‹¤." },
            { id: 13, name: "ì°¸ì¡´ KF94 í†¤ì—…í• ë¸”ë™ë¼ë²¨ ë§ˆìŠ¤í¬ ì¤‘í˜•", category: "ìƒí™œ/ê±´ê°•", price: 10900, originPrice: 20000, rating: 4.5, image: "ğŸ˜·", description: "ìŠ¤íƒ€ì¼ë¦¬ì‹œí•œ í•ê³¼ í¸ì•ˆí•œ í˜¸í¡ì„ ë™ì‹œì— ë§Œì¡±ì‹œí‚¤ëŠ” KF94 ë§ˆìŠ¤í¬ì…ë‹ˆë‹¤." },
            { id: 14, name: "ì  ë°”ë”” ì½”ë¡œë‚˜ ìê°€ ì§„ë‹¨ í‚¤íŠ¸ (10íšŒë¶„)", category: "ìƒí™œ/ê±´ê°•", price: 9350, originPrice: 13500, rating: 4.6, image: "ğŸ©º", description: "ë¹ ë¥´ê³  ê°„í¸í•˜ê²Œ ì½”ë¡œë‚˜ ê°ì—¼ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ìê°€ ê²€ì‚¬ í‚¤íŠ¸ì…ë‹ˆë‹¤." },
            { id: 15, name: "í—¬ë¡œì¹´ë´‡ ì‹œì¦Œ15 ë¬´ì†ŒìŒ êµì •ì “ê°€ë½ ì¼€ì´ìŠ¤ ì„¸íŠ¸", category: "ì£¼ë°©/ì‹ê¸°", price: 14900, originPrice: 19000, rating: 4.7, image: "ğŸ¤–", description: "ë‹¬ê·¸ë½ê±°ë¦¬ëŠ” ì†Œë¦¬ë¥¼ ì¤„ì¸ ë¬´ì†ŒìŒ ì¼€ì´ìŠ¤ê°€ í¬í•¨ëœ í—¬ë¡œì¹´ë´‡ ì “ê°€ë½ ì„¸íŠ¸ì…ë‹ˆë‹¤." },
            { id: 16, name: "ìœ„ì‹œìº£ í•˜íŠ¸ ì†ì¡ì´ íœ´ëŒ€ìš© ë³´í‹€ 380ml", category: "ì£¼ë°©/ì‹ê¸°", price: 8950, originPrice: 11000, rating: 4.5, image: "ğŸ¥¤", description: "ì‚¬ë‘ìŠ¤ëŸ¬ìš´ í•˜íŠ¸ ëª¨ì–‘ ì†ì¡ì´ê°€ ë‹¬ë¦° íœ´ëŒ€ìš© ë¬¼ë³‘ì…ë‹ˆë‹¤." },
            { id: 17, name: "ë°˜ì§í•‘ ìˆ˜ì €ì„¸íŠ¸ êµì • ì “ê°€ë½ (ì–´ë¦°ì´ì§‘ìš©)", category: "ì£¼ë°©/ì‹ê¸°", price: 13900, originPrice: 17900, rating: 4.7, image: "âœ¨", description: "ë¸”ë§ë¸”ë§ ë°˜ì§í•‘ ìºë¦­í„°ê°€ ë“¤ì–´ê°„ ìˆ˜ì € ì„¸íŠ¸ì…ë‹ˆë‹¤." },
            { id: 18, name: "ë¹›ë‚˜í•‘ ìˆ˜ì €ì„¸íŠ¸ êµì • ì “ê°€ë½ (ìœ ì¹˜ì›ìš©)", category: "ì£¼ë°©/ì‹ê¸°", price: 13900, originPrice: 17900, rating: 4.8, image: "ğŸŒŸ", description: "ìœ ì¹˜ì›ìƒì—ê²Œ ë”± ë§ëŠ” ì‚¬ì´ì¦ˆì˜ êµì • ì “ê°€ë½ ì„¸íŠ¸ì…ë‹ˆë‹¤." },
            { id: 19, name: "ì´ˆë¡±í•‘ ìˆ˜ì €ì„¸íŠ¸ êµì • ì “ê°€ë½ ì˜¬ì¸ì›", category: "ì£¼ë°©/ì‹ê¸°", price: 13900, originPrice: 17900, rating: 4.6, image: "ğŸ‹", description: "ì´ˆë¡±ì´ˆë¡±í•œ ëˆˆë§ìš¸ì˜ ì´ˆë¡±í•‘ ìºë¦­í„° ìˆ˜ì € ì„¸íŠ¸ì…ë‹ˆë‹¤." },
            { id: 20, name: "ìƒˆì½¤ë‹¬ì½¤ ìºì¹˜í‹°ë‹ˆí•‘ ë””ì €íŠ¸ìƒµ ìì„ ì†Œê¿‰ë†€ì´", category: "ì™„êµ¬/êµêµ¬", price: 27000, originPrice: 35000, rating: 4.9, image: "ğŸ°", description: "ë””ì €íŠ¸ ê°€ê²Œ ë†€ì´ë¥¼ í•  ìˆ˜ ìˆëŠ” í’ì„±í•œ êµ¬ì„±ì˜ ì†Œê¿‰ë†€ì´ ì„¸íŠ¸ì…ë‹ˆë‹¤." },
        ];

        // --- ì»´í¬ë„ŒíŠ¸ ---
        const ProductDetailPage = ({ product, onBack, onAddToCart }) => {
            const [quantity, setQuantity] = useState(1);
            useEffect(() => { lucide.createIcons(); }, []);

            return (
                <div className="animate-in slide-in-from-right duration-300 bg-white min-h-screen flex flex-col pb-[80px]">
                    <div className="sticky top-0 z-20 bg-white/90 backdrop-blur-md border-b border-slate-100 px-4 h-14 flex items-center gap-4">
                        <button onClick={onBack} className="p-2 -ml-2 hover:bg-slate-100 rounded-full"><Icon name="ArrowLeft" className="w-6 h-6 text-slate-600" /></button>
                        <h2 className="font-bold text-lg text-slate-800 truncate pr-4 flex-1">{product.name}</h2>
                    </div>
                    <div className="flex-1 overflow-y-auto">
                        <div className="max-w-3xl mx-auto px-5 py-8">
                            <div className="bg-slate-50 aspect-square w-full flex items-center justify-center mb-6 rounded-xl">
                                <span className="text-[8rem]">{product.image}</span>
                            </div>
                            <h1 className="text-xl font-bold text-slate-900 mb-4">{product.name}</h1>
                            <div className="text-2xl font-bold text-slate-900 mb-6">â‚©{new Intl.NumberFormat('ko-KR').format(product.price)}</div>
                            <p className="text-slate-600 bg-slate-50 p-5 rounded-xl border border-slate-100 mb-8">{product.description}</p>
                        </div>
                    </div>
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 p-4 safe-area-bottom">
                        <div className="max-w-3xl mx-auto flex gap-4">
                            <div className="flex items-center gap-4 bg-slate-100 rounded-lg p-1">
                                <button onClick={() => setQuantity(q => Math.max(1, q-1))} className="w-9 h-9 flex items-center justify-center bg-white rounded shadow-sm"><Icon name="Minus" className="w-4 h-4" /></button>
                                <span className="font-bold w-8 text-center">{quantity}</span>
                                <button onClick={() => setQuantity(q => q+1)} className="w-9 h-9 flex items-center justify-center bg-white rounded shadow-sm"><Icon name="Plus" className="w-4 h-4" /></button>
                            </div>
                            <button onClick={() => { onAddToCart(product, quantity); onBack(); }} className="flex-1 bg-slate-800 text-white font-bold rounded-xl flex items-center justify-center gap-2">ë‹´ê¸°</button>
                        </div>
                    </div>
                </div>
            );
        };

        const LoginPage = () => {
            const [isLoginMode, setIsLoginMode] = useState(true);
            const [isAddrOpen, setIsAddrOpen] = useState(false);
            const addrWrapRef = useRef(null);
            const [loading, setLoading] = useState(false);
            const [formData, setFormData] = useState({ email: '', password: '', confirmPassword: '', name: '', zipcode: '', address: '', addressDetail: '', storeName: '', businessNumber: '' });

            useEffect(() => { lucide.createIcons(); }, []);

            // ì£¼ì†Œê²€ìƒ‰ ë¡œì§
            useEffect(() => {
                if (isAddrOpen && addrWrapRef.current && window.daum && window.daum.Postcode) {
                    addrWrapRef.current.innerHTML = '';
                    new window.daum.Postcode({
                        oncomplete: function(data) {
                            let addr = data.userSelectedType === 'R' ? data.roadAddress : data.jibunAddress;
                            setFormData(prev => ({ ...prev, zipcode: data.zonecode, address: addr }));
                            setIsAddrOpen(false); 
                        },
                        width: '100%', height: '100%'
                    }).embed(addrWrapRef.current);
                }
            }, [isAddrOpen]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                // ì•ˆì „ì¥ì¹˜: window.authê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (!window.auth) {
                    alert("ë¡œê·¸ì¸ ì‹œìŠ¤í…œì´ ë¡œë”©ì¤‘ì…ë‹ˆë‹¤. 3ì´ˆ ë’¤ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                    setLoading(false);
                    return;
                }

                try {
                    if (isLoginMode) {
                        await window.signInUser(window.auth, formData.email, formData.password);
                    } else {
                        if (formData.password !== formData.confirmPassword) {
                            alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜"); setLoading(false); return;
                        }
                        await window.createUser(window.auth, formData.email, formData.password);
                        alert("ê°€ì… ì™„ë£Œ!");
                    }
                } catch (error) {
                    console.error(error);
                    if(error.code === 'auth/email-already-in-use') alert("ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.");
                    else if(error.code === 'auth/invalid-credential') alert("ì•„ì´ë””/ë¹„ë²ˆì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    else alert("ì˜¤ë¥˜: " + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleChange = (e) => setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100 p-4">
                    <div className="bg-white rounded-2xl shadow-xl w-full max-w-md p-8">
                        <div className="text-center mb-8">
                            <h1 className="text-2xl font-bold">{isLoginMode ? "SJ íŒŒíŠ¸ë„ˆ ë¡œê·¸ì¸" : "ì‚¬ì—…ì íšŒì›ë“±ë¡"}</h1>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input name="email" type="email" placeholder="ì´ë©”ì¼" className="w-full p-3 border rounded-lg" onChange={handleChange} required />
                            <input name="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" className="w-full p-3 border rounded-lg" onChange={handleChange} required />
                            {!isLoginMode && (
                                <>
                                    <input name="confirmPassword" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" className="w-full p-3 border rounded-lg" onChange={handleChange} required />
                                    <input name="storeName" type="text" placeholder="ìƒí˜¸ëª…" className="w-full p-3 border rounded-lg" onChange={handleChange} />
                                    <div className="flex gap-2">
                                        <input name="address" value={formData.address} readOnly placeholder="ì£¼ì†Œ" className="w-full p-3 border rounded-lg bg-slate-50" />
                                        <button type="button" onClick={() => setIsAddrOpen(true)} className="bg-slate-600 text-white px-3 rounded-lg text-sm">ê²€ìƒ‰</button>
                                    </div>
                                    <input name="addressDetail" placeholder="ìƒì„¸ì£¼ì†Œ" className="w-full p-3 border rounded-lg" onChange={handleChange} />
                                </>
                            )}
                            <button type="submit" disabled={loading} className="w-full bg-slate-800 text-white py-4 rounded-xl font-bold mt-4">
                                {loading ? "ì²˜ë¦¬ì¤‘..." : (isLoginMode ? "ë¡œê·¸ì¸" : "íšŒì›ê°€ì…")}
                            </button>
                        </form>
                        <div className="mt-6 text-center">
                            <button onClick={() => setIsLoginMode(!isLoginMode)} className="text-sm underline">
                                {isLoginMode ? "íšŒì›ê°€ì… í•˜ê¸°" : "ë¡œê·¸ì¸ í•˜ê¸°"}
                            </button>
                        </div>
                    </div>
                    {isAddrOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
                            <div className="bg-white w-full max-w-lg h-[500px] rounded-xl overflow-hidden relative">
                                <button onClick={() => setIsAddrOpen(false)} className="absolute top-2 right-2 p-2 bg-white z-10 rounded-full shadow"><Icon name="X" className="w-6 h-6" /></button>
                                <div ref={addrWrapRef} className="w-full h-full"></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [cart, setCart] = useState([]);
            const [isCartOpen, setIsCartOpen] = useState(false);

            useEffect(() => { lucide.createIcons(); }, [user, selectedProduct, isCartOpen]);

            useEffect(() => {
                // ì•ˆì „ì¥ì¹˜: window.authê°€ ë¡œë“œë  ë•Œê¹Œì§€ ì¬ì‹œë„ (ìµœëŒ€ 5ì´ˆ)
                let retryCount = 0;
                const checkAuth = setInterval(() => {
                    if (window.auth) {
                        clearInterval(checkAuth);
                        window.auth.onAuthStateChanged((u) => {
                            setUser(u);
                            setLoading(false);
                        });
                    } else {
                        retryCount++;
                        if (retryCount > 50) { // 5ì´ˆ ê²½ê³¼
                            clearInterval(checkAuth);
                            alert("ë¡œê·¸ì¸ ì‹œìŠ¤í…œ ë¡œë”© ì‹¤íŒ¨. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
                            setLoading(false);
                        }
                    }
                }, 100);
                return () => clearInterval(checkAuth);
            }, []);

            const addToCart = (product, qty) => {
                setCart(prev => {
                    const idx = prev.findIndex(p => p.id === product.id);
                    if (idx > -1) {
                        const newCart = [...prev]; newCart[idx].quantity += qty; return newCart;
                    }
                    return [...prev, { ...product, quantity: qty }];
                });
                alert("ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° ì™„ë£Œ");
            };

            if (loading) return <div className="flex h-screen items-center justify-center">ì‹œìŠ¤í…œ ë¡œë”©ì¤‘...</div>;
            if (!user) return <LoginPage />;
            if (selectedProduct) return <ProductDetailPage product={selectedProduct} onBack={() => setSelectedProduct(null)} onAddToCart={addToCart} />;

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 pb-20">
                    <header className="sticky top-0 z-40 bg-white shadow-sm px-4 h-16 flex items-center justify-between">
                        <div className="flex items-center gap-2">
                            <div className="bg-slate-800 w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold">S</div>
                            <span className="font-bold text-lg hidden sm:block">SJ Innovation</span>
                        </div>
                        <div className="flex gap-4 items-center">
                            <button onClick={() => setIsCartOpen(true)} className="relative p-2">
                                <Icon name="Boxes" className="w-6 h-6" />
                                {cart.length > 0 && <span className="absolute top-0 right-0 bg-red-500 text-white text-[10px] px-1.5 rounded-full">{cart.length}</span>}
                            </button>
                            <button onClick={() => window.logOut(window.auth)} className="text-slate-400"><Icon name="LogOut" className="w-5 h-5" /></button>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-4 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                        {PRODUCTS.map(product => (
                            <div key={product.id} onClick={() => setSelectedProduct(product)} className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden cursor-pointer hover:shadow-lg transition-all">
                                <div className="aspect-square bg-slate-100 flex items-center justify-center text-6xl">{product.image}</div>
                                <div className="p-4">
                                    <h3 className="font-bold text-slate-800 truncate">{product.name}</h3>
                                    <div className="mt-2 flex justify-between items-end">
                                        <span className="text-sm text-slate-500 line-through">â‚©{new Intl.NumberFormat('ko-KR').format(product.originPrice)}</span>
                                        <span className="text-lg font-bold text-indigo-600">â‚©{new Intl.NumberFormat('ko-KR').format(product.price)}</span>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </main>

                    {isCartOpen && (
                        <div className="fixed inset-0 z-50 flex justify-end">
                            <div className="absolute inset-0 bg-black/30" onClick={() => setIsCartOpen(false)}></div>
                            <div className="relative w-full max-w-md bg-white h-full shadow-2xl flex flex-col p-4 animate-in slide-in-from-right">
                                <div className="flex justify-between items-center mb-4"><h2 className="font-bold text-lg">ì¥ë°”êµ¬ë‹ˆ</h2><button onClick={() => setIsCartOpen(false)}><Icon name="X" /></button></div>
                                <div className="flex-1 overflow-y-auto space-y-4">
                                    {cart.map((item, idx) => (
                                        <div key={idx} className="flex gap-4 border-b pb-4">
                                            <div className="w-16 h-16 bg-slate-100 rounded flex items-center justify-center text-2xl">{item.image}</div>
                                            <div className="flex-1">
                                                <div className="font-bold truncate">{item.name}</div>
                                                <div className="text-sm text-slate-500">{item.quantity}ê°œ / â‚©{new Intl.NumberFormat('ko-KR').format(item.price * item.quantity)}</div>
                                            </div>
                                            <button onClick={() => setCart(c => c.filter((_, i) => i !== idx))} className="text-red-500"><Icon name="X" className="w-4 h-4" /></button>
                                        </div>
                                    ))}
                                </div>
                                <div className="border-t pt-4">
                                    <div className="flex justify-between font-bold text-xl mb-4"><span>ì´ í•©ê³„</span><span>â‚©{new Intl.NumberFormat('ko-KR').format(cart.reduce((a,c) => a + c.price*c.quantity, 0))}</span></div>
                                    <button className="w-full bg-slate-800 text-white py-4 rounded-xl font-bold">ë°œì£¼ ì‹ ì²­í•˜ê¸°</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
