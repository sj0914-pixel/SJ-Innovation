<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SJ íŒŒíŠ¸ë„ˆìŠ¤ ëª° (Complete)</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, setDoc, updateDoc } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCpFn2uM7Dibf9UpWZdSVOxOqcYceZwUtI",
            authDomain: "sj-innovation-a8f6b.firebaseapp.com",
            projectId: "sj-innovation-a8f6b",
            storageBucket: "sj-innovation-a8f6b.firebasestorage.app",
            messagingSenderId: "449389360798",
            appId: "1:449389360798:web:d1b490aa9c75807903ed8f",
            measurementId: "G-NED86350PH"
        };

        try {
            const app = initializeApp(firebaseConfig);
            window.auth = getAuth(app);
            window.db = getFirestore(app);
            window.createUser = createUserWithEmailAndPassword;
            window.signInUser = signInWithEmailAndPassword;
            window.logOut = signOut;
            window.fs = { collection, getDocs, doc, setDoc, updateDoc };
            console.log("Firebase Connected");
        } catch (e) {
            console.error("Firebase Init Error", e);
        }
    </script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, ...props }) => {
            const iconName = name.charAt(0).toLowerCase() + name.slice(1);
            return <i data-lucide={iconName} {...props}></i>;
        };

        // --- ì´ˆê¸° ìƒí’ˆ ë°ì´í„° ---
        const INITIAL_PRODUCTS = [
            { id: "p1", name: "ìºì¹˜í‹°ë‹ˆí•‘ í•˜ì¸„í•‘ ë°©í•œìš©í’ˆ ëª¨ìŒì „", category: "ìœ ì•„ë™ì˜ë¥˜", price: 11900, originPrice: 23000, rating: 4.9, image: "ğŸ§£", description: "ê²¨ìš¸ ì‹œì¦Œ í•„ìˆ˜ ì•„ì´í…œ! í•˜ì¸„í•‘ ìºë¦­í„° ë°©í•œ ì¥ê°‘ê³¼ ëª©ë„ë¦¬ ì„¸íŠ¸.", stock: 100 },
            { id: "p2", name: "í‹°ë‹ˆí•‘ ë§ˆìŠ¤í¬ ì‹œì¦Œ3 ìƒˆë¶€ë¦¬í˜• (20ë§¤)", category: "ìƒí™œ/ê±´ê°•", price: 12900, originPrice: 15900, rating: 4.8, image: "ğŸ˜·", description: "ìˆ¨ì‰¬ê¸° í¸í•œ ìƒˆë¶€ë¦¬í˜• êµ¬ì¡°.", stock: 500 },
            { id: "p3", name: "ìŠˆíŒ…ìŠ¤íƒ€ í•˜ì¸„í•‘ ìœ ì•„ í„¸ëª©ë„ë¦¬", category: "ìœ ì•„ë™ì˜ë¥˜", price: 12900, originPrice: 21900, rating: 4.9, image: "ğŸ§£", description: "í¬ê·¼í•œ ê°ì´‰ì˜ í„¸ëª©ë„ë¦¬.", stock: 50 },
            { id: "p4", name: "ì´íƒˆë¦¬ì•ˆ ë¸Œë ˆì¸ë¡¯ ëœë¤ ë”±ì§€ (25íŒ©)", category: "ì™„êµ¬/êµêµ¬", price: 22900, originPrice: 39900, rating: 4.8, image: "ğŸ²", description: "ì´ˆë“±í•™ìƒ ëŒ€ìœ í–‰ ì•„ì´í…œ.", stock: 200 },
            { id: "p5", name: "ìì„ ê¸€ì í•œê¸€í”ŒëŸ¬ìŠ¤", category: "ì™„êµ¬/êµêµ¬", price: 39900, originPrice: 49900, rating: 4.9, image: "ğŸ§²", description: "ë†€ë©´ì„œ ë°°ìš°ëŠ” í•œê¸€ ê³µë¶€.", stock: 30 },
            { id: "p6", name: "êµì • ì “ê°€ë½ ìŠ¤í‘¼ í¬í¬ ì„¸íŠ¸", category: "ì£¼ë°©/ì‹ê¸°", price: 13900, originPrice: 17500, rating: 4.8, image: "ğŸ¥¢", description: "ì˜¬ë°”ë¥¸ ì “ê°€ë½ì§ˆ ìŠµê´€.", stock: 150 },
            { id: "p7", name: "ë…¼ìŠ¬ë¦½ ìŠ¤í…ì»µ (ì™•ìí•‘)", category: "ì£¼ë°©/ì‹ê¸°", price: 9900, originPrice: 15000, rating: 4.7, image: "ğŸ¥›", description: "ë¯¸ë„ëŸ¼ ë°©ì§€ ì²˜ë¦¬.", stock: 80 },
            { id: "p8", name: "ìœ ì•„ ì–´ë¦°ì´ ì•ˆì‹¬ë½ ìŠ¤íŠ¸ë© ë³´í‹€", category: "ì£¼ë°©/ì‹ê¸°", price: 8900, originPrice: 12500, rating: 4.6, image: "ğŸ¼", description: "ì›í„°ì¹˜ ì˜¤í”ˆ ë°©ì‹.", stock: 120 },
            { id: "p9", name: "ë””ì €íŠ¸ìƒµ ìì„ ì†Œê¿‰ë†€ì´", category: "ì™„êµ¬/êµêµ¬", price: 27000, originPrice: 35000, rating: 4.9, image: "ğŸ°", description: "ë””ì €íŠ¸ ê°€ê²Œ ë†€ì´.", stock: 40 },
            { id: "p10", name: "KF94 í†¤ì—…í• ë¸”ë™ë¼ë²¨ ë§ˆìŠ¤í¬", category: "ìƒí™œ/ê±´ê°•", price: 10900, originPrice: 20000, rating: 4.5, image: "ğŸ˜·", description: "ìŠ¤íƒ€ì¼ë¦¬ì‹œí•œ í•.", stock: 300 }
        ];

        const CATEGORIES = ["ì „ì²´", "ìœ ì•„ë™ì˜ë¥˜", "ì™„êµ¬/êµêµ¬", "ì£¼ë°©/ì‹ê¸°", "ìƒí™œ/ê±´ê°•"];

        // --------------------------------------------------------
        // [1] ê´€ë¦¬ì í˜ì´ì§€ (DBì— ì €ì¥ëœ ìƒì„¸ íšŒì›ì •ë³´ í™•ì¸ ê°€ëŠ¥)
        // --------------------------------------------------------
        const AdminPage = ({ products, onLogout }) => {
            const [localProducts, setLocalProducts] = useState(products);
            const [users, setUsers] = useState([]);
            const [tab, setTab] = useState("products");

            useEffect(() => {
                const fetchUsers = async () => {
                    if(!window.fs) return;
                    const snap = await window.fs.getDocs(window.fs.collection(window.db, "users"));
                    setUsers(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                };
                if(tab === "users") fetchUsers();
            }, [tab]);

            const handleStockUpdate = async (id, newStock) => {
                const stockVal = parseInt(newStock);
                setLocalProducts(prev => prev.map(p => p.id === id ? { ...p, stock: stockVal } : p));
                try {
                    const { doc, updateDoc } = window.fs;
                    await updateDoc(doc(window.db, "products", id), { stock: stockVal });
                } catch(e) { alert("ì‹¤íŒ¨: " + e.message); }
            };

            return (
                <div className="min-h-screen bg-slate-100">
                    <nav className="bg-slate-900 text-white p-4 flex justify-between items-center shadow-md">
                        <div className="flex items-center gap-2">
                            <span className="bg-red-500 text-xs px-2 py-1 rounded font-bold">ADMIN</span>
                            <span className="font-bold">SJ ê´€ë¦¬ì ëª¨ë“œ</span>
                        </div>
                        <button onClick={onLogout} className="text-sm bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded">ë¡œê·¸ì•„ì›ƒ</button>
                    </nav>
                    <div className="max-w-7xl mx-auto p-6">
                        <div className="flex gap-4 mb-6">
                            <button onClick={()=>setTab("products")} className={`px-4 py-2 rounded font-bold ${tab==="products"?"bg-white":"bg-slate-200"}`}>ìƒí’ˆ ê´€ë¦¬</button>
                            <button onClick={()=>setTab("users")} className={`px-4 py-2 rounded font-bold ${tab==="users"?"bg-white":"bg-slate-200"}`}>íšŒì› ê´€ë¦¬</button>
                        </div>

                        {tab === "products" ? (
                            <div className="bg-white rounded-xl shadow-sm overflow-hidden">
                                <table className="w-full text-left text-sm">
                                    <thead className="bg-slate-100 uppercase"><tr><th className="p-3">ìƒí’ˆëª…</th><th className="p-3">ì¬ê³ </th></tr></thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {localProducts.map(p => (
                                            <tr key={p.id}>
                                                <td className="p-3 font-medium">{p.name}</td>
                                                <td className="p-3"><input type="number" value={p.stock} onChange={(e) => handleStockUpdate(p.id, e.target.value)} className="w-20 border rounded text-center" /></td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="bg-white rounded-xl shadow-sm overflow-hidden overflow-x-auto">
                                <table className="w-full text-left text-sm whitespace-nowrap">
                                    <thead className="bg-slate-100 uppercase">
                                        <tr><th className="p-3">ìƒí˜¸ëª…</th><th className="p-3">ëŒ€í‘œì</th><th className="p-3">ì—°ë½ì²˜</th><th className="p-3">ì‚¬ì—…ìë²ˆí˜¸</th><th className="p-3">ì´ë©”ì¼</th></tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {users.map(u => (
                                            <tr key={u.id}>
                                                <td className="p-3 font-bold">{u.storeName}</td>
                                                <td className="p-3">{u.repName}</td>
                                                <td className="p-3">{u.mobile}</td>
                                                <td className="p-3">{u.businessNumber}</td>
                                                <td className="p-3">{u.email}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --------------------------------------------------------
        // [2] ë¡œê·¸ì¸/íšŒì›ê°€ì… í˜ì´ì§€ (ì‚¬ì¥ë‹˜ì˜ ì˜ˆìœ ë””ìì¸ + ì‹¤ì œ ê¸°ëŠ¥)
        // --------------------------------------------------------
        const LoginPage = ({ onAdminLogin }) => {
            const [isLoginMode, setIsLoginMode] = useState(true);
            const [isAddrOpen, setIsAddrOpen] = useState(false);
            const addrWrapRef = useRef(null);
            const [loading, setLoading] = useState(false);
            
            // ì‚¬ì¥ë‹˜ ì½”ë“œì˜ ìƒì„¸ í•„ë“œë“¤
            const [formData, setFormData] = useState({
                username: '', password: '', confirmPassword: '', name: '', mobile: '', email: '',
                zipcode: '', address: '', addressDetail: '',
                businessType: 'ë¬¸êµ¬/íŒ¬ì‹œì ', storeName: '', repName: '', businessNumber: '', 
                businessCategory: '', businessItem: '', taxEmail: ''
            });

            useEffect(() => { lucide.createIcons(); }, []);

            // ì£¼ì†Œ ì°¾ê¸°
            useEffect(() => {
                if (isAddrOpen && addrWrapRef.current && window.daum && window.daum.Postcode) {
                    addrWrapRef.current.innerHTML = '';
                    new window.daum.Postcode({
                        oncomplete: function(data) {
                            let addr = data.userSelectedType === 'R' ? data.roadAddress : data.jibunAddress;
                            if(data.buildingName) addr += ` (${data.buildingName})`;
                            setFormData(prev => ({ ...prev, zipcode: data.zonecode, address: addr }));
                            setIsAddrOpen(false); 
                        },
                        width: '100%', height: '100%'
                    }).embed(addrWrapRef.current);
                }
            }, [isAddrOpen]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);

                // â˜… ê´€ë¦¬ì ë¡œê·¸ì¸ ì²´í¬ (sj / 0914) â˜…
                // ì´ë©”ì¼ ì¹¸ì— 'sj', ë¹„ë²ˆ ì¹¸ì— '0914' ë„£ìœ¼ë©´ ê´€ë¦¬ì ëª¨ë“œ
                const loginId = isLoginMode ? formData.username : formData.email;
                if (isLoginMode && formData.username === 'sj' && formData.password === '0914') {
                    onAdminLogin();
                    return;
                }

                if (!window.auth) { alert("ì‹œìŠ¤í…œ ë¡œë”©ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."); setLoading(false); return; }

                try {
                    if (isLoginMode) {
                        // ë¡œê·¸ì¸ ì‹œë„ (ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸)
                        await window.signInUser(window.auth, formData.username, formData.password);
                    } else {
                        // íšŒì›ê°€ì… ì‹œë„
                        if (formData.password !== formData.confirmPassword) { alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜"); setLoading(false); return; }
                        if (!formData.email.includes("@")) { alert("ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”."); setLoading(false); return; }

                        // 1. ì¸ì¦ ê³„ì • ìƒì„±
                        const cred = await window.createUser(window.auth, formData.email, formData.password);
                        
                        // 2. DBì— ìƒì„¸ ì •ë³´ ì €ì¥ (ì‚¬ì¥ë‹˜ì´ ë§Œë“œì‹  í•„ë“œ ì „ë¶€ ì €ì¥)
                        const { doc, setDoc } = window.fs;
                        await setDoc(doc(window.db, "users", cred.user.uid), {
                            email: formData.email, // ë¡œê·¸ì¸ìš© ì´ë©”ì¼
                            displayId: formData.username, // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì•„ì´ë””
                            name: formData.name,
                            mobile: formData.mobile,
                            address: `${formData.address} ${formData.addressDetail}`,
                            businessType: formData.businessType,
                            storeName: formData.storeName,
                            repName: formData.repName,
                            businessNumber: formData.businessNumber,
                            businessCategory: formData.businessCategory,
                            businessItem: formData.businessItem,
                            taxEmail: formData.taxEmail,
                            joinedAt: new Date().toISOString(),
                            status: "ìŠ¹ì¸ëŒ€ê¸°"
                        });
                        alert("ê°€ì… ì™„ë£Œ! ìë™ ë¡œê·¸ì¸ë©ë‹ˆë‹¤.");
                    }
                } catch (err) {
                    console.error(err);
                    if(err.code === 'auth/email-already-in-use') alert("ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.");
                    else if(err.code === 'auth/invalid-email') alert("ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    else if(err.code === 'auth/invalid-credential') alert("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                    else alert("ì˜¤ë¥˜: " + err.message);
                    setLoading(false);
                }
            };

            const handleChange = (e) => setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100 px-4 py-8 sm:px-6 lg:px-8 transition-all duration-500">
                    <div className={`bg-white rounded-2xl shadow-xl w-full mx-auto transition-all duration-500 ${isLoginMode ? 'max-w-md p-6 sm:p-8' : 'max-w-3xl p-6 sm:p-8'}`}>
                        <div className="text-center mb-8">
                            <div className="bg-slate-800 w-14 h-14 sm:w-16 sm:h-16 rounded-xl flex items-center justify-center mx-auto mb-4 text-white text-2xl sm:text-3xl font-bold shadow-lg">S</div>
                            <h1 className="text-2xl font-bold text-slate-800">{isLoginMode ? "SJ íŒŒíŠ¸ë„ˆ ë¡œê·¸ì¸" : "ì‚¬ì—…ì íšŒì›ë“±ë¡"}</h1>
                            <p className="text-slate-500 mt-2 text-sm font-semibold">SJ Innovation</p>
                        </div>
                        
                        <form onSubmit={handleSubmit} className="space-y-6">
                            {isLoginMode && (
                                <div className="space-y-4">
                                    <div><label className="block text-sm font-medium text-slate-700 mb-1">ì•„ì´ë”” (ì´ë©”ì¼)</label><input name="username" type="text" placeholder="example@naver.com" className="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-slate-500 outline-none" onChange={handleChange} required /></div>
                                    <div><label className="block text-sm font-medium text-slate-700 mb-1">ë¹„ë°€ë²ˆí˜¸</label><input name="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" className="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-slate-500 outline-none" onChange={handleChange} required /></div>
                                </div>
                            )}

                            {!isLoginMode && (
                                <div className="space-y-8 animate-in fade-in duration-500">
                                    <section className="bg-slate-50 p-4 sm:p-6 rounded-xl border border-slate-200">
                                        <h3 className="text-lg font-bold text-slate-800 mb-4 border-b border-slate-200 pb-2">í•„ìˆ˜ì •ë³´ <span className="text-red-500 text-sm">*</span></h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div><label className="block text-sm font-medium text-slate-700 mb-1">ì´ë¦„(ì‹¤ëª…)</label><input name="name" type="text" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                            <div><label className="block text-sm font-medium text-slate-700 mb-1">ì•„ì´ë”” (í‘œì‹œìš©)</label><input name="username" type="text" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                            <div><label className="block text-sm font-medium text-slate-700 mb-1">ë¹„ë°€ë²ˆí˜¸</label><input name="password" type="password" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                            <div><label className="block text-sm font-medium text-slate-700 mb-1">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label><input name="confirmPassword" type="password" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                            <div><label className="block text-sm font-medium text-slate-700 mb-1">íœ´ëŒ€í° ë²ˆí˜¸</label><input name="mobile" type="tel" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                            <div><label className="block text-sm font-medium text-slate-700 mb-1">ì´ë©”ì¼ (ë¡œê·¸ì¸ IDë¡œ ì‚¬ìš©ë¨)</label><input name="email" type="email" placeholder="example@naver.com" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                        </div>
                                        <div className="mt-4">
                                            <label className="block text-sm font-medium text-slate-700 mb-1">ê¸°ë³¸ ë°°ì†¡ì§€ ì£¼ì†Œ</label>
                                            <div className="flex gap-2 mb-2"><input name="zipcode" type="text" value={formData.zipcode} readOnly className="w-24 px-3 py-2 rounded border border-slate-300 bg-slate-100 text-sm" placeholder="ìš°í¸ë²ˆí˜¸" /><button type="button" onClick={() => setIsAddrOpen(true)} className="bg-slate-600 text-white text-xs px-3 rounded hover:bg-slate-700">ì£¼ì†Œê²€ìƒ‰</button></div>
                                            <input name="address" type="text" value={formData.address} readOnly className="w-full px-3 py-2 rounded border border-slate-300 bg-slate-100 mb-2" placeholder="ê¸°ë³¸ ì£¼ì†Œ" />
                                            <input name="addressDetail" type="text" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" placeholder="ìƒì„¸ì£¼ì†Œ" onChange={handleChange} />
                                        </div>
                                    </section>

                                    <section className="bg-slate-50 p-4 sm:p-6 rounded-xl border border-slate-200">
                                        <h3 className="text-lg font-bold text-slate-800 mb-4 border-b border-slate-200 pb-2">ì‚¬ì—…ì í•„ìˆ˜ì •ë³´ <span className="text-red-500 text-sm">*</span></h3>
                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-slate-700 mb-2">ì‚¬ì—… í˜•íƒœ</label>
                                            <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                                {['ë¬¸êµ¬/íŒ¬ì‹œì ', 'ê³¼ì/ì•„ì´ìŠ¤í¬ë¦¼', 'í¸ì˜ì ', 'í‚¤ì¦ˆì¹´í˜', 'ê¸°íƒ€ì—…ì¢…'].map((type) => (
                                                    <label key={type} className="flex items-center gap-2 text-sm cursor-pointer p-2 border rounded hover:bg-white transition-colors">
                                                        <input type="radio" name="businessType" value={type} checked={formData.businessType === type} onChange={handleChange} className="text-slate-600 focus:ring-slate-500" />{type}
                                                    </label>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div><label className="block text-sm font-medium text-slate-700 mb-1">ìƒí˜¸ëª…(ë²•ì¸ëª…)</label><input name="storeName" type="text" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                            <div><label className="block text-sm font-medium text-slate-700 mb-1">ëŒ€í‘œìëª…</label><input name="repName" type="text" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                            <div className="md:col-span-2"><label className="block text-sm font-medium text-slate-700 mb-1">ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸</label><input name="businessNumber" type="text" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                            <div><label className="block text-sm font-medium text-slate-700 mb-1">ì—…íƒœ</label><input name="businessCategory" type="text" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                            <div><label className="block text-sm font-medium text-slate-700 mb-1">ì¢…ëª©</label><input name="businessItem" type="text" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                            <div className="md:col-span-2"><label className="block text-sm font-medium text-slate-700 mb-1">ì„¸ê¸ˆê³„ì‚°ì„œ ì´ë©”ì¼</label><input name="taxEmail" type="email" className="w-full px-3 py-2 rounded border border-slate-300 focus:border-slate-500 outline-none" onChange={handleChange} required /></div>
                                        </div>
                                        <div className="mt-4 p-3 bg-slate-50 rounded-lg text-xs text-slate-700 flex items-start gap-2 border border-slate-200"><Icon name="Check" className="w-4 h-4 mt-0.5 flex-shrink-0 text-red-500" /><span>í—ˆìœ„ ì •ë³´ ê¸°ì¬ ì‹œ ë²•ì  ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë©°, ë¶€ì •í™•í•œ ì •ë³´ ì…ë ¥ ì‹œ ì •íšŒì› ìŠ¹ì¸ì´ ê±°ì ˆë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span></div>
                                    </section>
                                </div>
                            )}
                            <button type="submit" disabled={loading} className="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-4 rounded-xl transition-colors shadow-lg hover:shadow-xl mt-4 text-lg">
                                {loading ? "ì²˜ë¦¬ì¤‘..." : (isLoginMode ? "ë¡œê·¸ì¸í•˜ê¸°" : "ì‚¬ì—…ì íšŒì›ë“±ë¡ ì‹ ì²­")}
                            </button>
                        </form>
                        <div className="mt-6 text-center border-t border-slate-100 pt-6">
                            <p className="text-sm text-slate-600">
                                {isLoginMode ? "ì•„ì§ íŒŒíŠ¸ë„ˆ íšŒì›ì´ ì•„ë‹ˆì‹ ê°€ìš”?" : "ì´ë¯¸ ì•„ì´ë””ê°€ ìˆìœ¼ì‹ ê°€ìš”?"}
                                <button onClick={() => { setIsLoginMode(!isLoginMode); window.scrollTo(0, 0); }} className="ml-2 font-bold text-slate-800 hover:underline focus:outline-none">
                                    {isLoginMode ? "ì‚¬ì—…ì íšŒì›ê°€ì…" : "ë¡œê·¸ì¸í•˜ê¸°"}
                                </button>
                            </p>
                        </div>
                    </div>
                    {isAddrOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
                            <div className="bg-white w-full max-w-lg rounded-xl overflow-hidden shadow-2xl relative h-[500px] flex flex-col">
                                <div className="p-4 border-b flex justify-between items-center bg-slate-50"><h3 className="font-bold text-lg">ì£¼ì†Œ ê²€ìƒ‰</h3><button onClick={() => setIsAddrOpen(false)} className="p-1 hover:bg-slate-200 rounded-full"><Icon name="X" className="w-6 h-6 text-slate-500" /></button></div>
                                <div ref={addrWrapRef} className="flex-1 w-full bg-slate-100 relative"></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const formatPrice = (price) => new Intl.NumberFormat('ko-KR').format(price);

        // --- [ì‡¼í•‘ëª° ë©”ì¸ í˜ì´ì§€] ---
        const ShopPage = ({ products, user, onLogout }) => {
            const [cart, setCart] = useState([]);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [selectedCategory, setSelectedCategory] = useState("ì „ì²´");
            const [searchTerm, setSearchTerm] = useState("");
            const [selectedProduct, setSelectedProduct] = useState(null);

            useEffect(() => { lucide.createIcons(); }, [cart, isCartOpen, selectedProduct]);

            const addToCart = (product, quantity = 1) => {
                setCart(prev => {
                    const idx = prev.findIndex(item => item.id === product.id);
                    if (idx > -1) { const newCart = [...prev]; newCart[idx].quantity += quantity; return newCart; }
                    return [...prev, { ...product, quantity }];
                });
                alert(`${product.name} ${quantity}ê°œ ë‹´ê¸° ì™„ë£Œ`);
            };

            const filteredProducts = products.filter(p => {
                const matchCat = selectedCategory === "ì „ì²´" || p.category === selectedCategory;
                const matchSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase());
                return matchCat && matchSearch;
            });

            // ìƒí’ˆ ìƒì„¸ íŒì—… (ë””ìì¸ ìœ ì§€)
            const ProductDetail = ({ product, onBack, onAddToCart }) => {
                const [qty, setQty] = useState(1);
                return (
                    <div className="animate-in slide-in-from-right duration-300 bg-white min-h-screen flex flex-col pb-[80px]">
                        <div className="sticky top-0 z-20 bg-white/90 backdrop-blur-md border-b px-4 h-14 flex items-center gap-4">
                            <button onClick={onBack}><Icon name="ArrowLeft" /></button>
                            <h2 className="font-bold flex-1 truncate">{product.name}</h2>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4">
                            <div className="bg-slate-50 aspect-square flex items-center justify-center text-[8rem] rounded-xl mb-6">{product.image}</div>
                            <h1 className="text-xl font-bold mb-4">{product.name}</h1>
                            <div className="flex items-end gap-3 mb-6 pb-6 border-b">
                                <span className="text-2xl font-bold">â‚©{formatPrice(product.price)}</span>
                                <span className="text-slate-400 line-through">â‚©{formatPrice(product.originPrice)}</span>
                            </div>
                            <div className="bg-indigo-50 text-indigo-900 p-4 rounded-lg mb-8 text-sm">
                                <span className="font-bold block">ì¬ê³ : {product.stock}ê°œ</span>
                                <span>ë„ë§¤ ì „ìš© ìƒí’ˆ (ì¹´í†¤ ë‹¨ìœ„ ì¶œê³ )</span>
                            </div>
                            <p className="text-slate-600 bg-slate-50 p-4 rounded-xl">{product.description}</p>
                        </div>
                        <div className="fixed bottom-0 left-0 right-0 bg-white border-t p-4 shadow z-30">
                            <div className="max-w-3xl mx-auto flex gap-4">
                                <div className="flex items-center gap-4 bg-slate-100 rounded-lg p-1">
                                    <button onClick={()=>setQty(q=>Math.max(1,q-1))} className="w-8 h-8 bg-white rounded"><Icon name="Minus" className="w-4 h-4"/></button>
                                    <span className="font-bold w-6 text-center">{qty}</span>
                                    <button onClick={()=>setQty(q=>q+1)} className="w-8 h-8 bg-white rounded"><Icon name="Plus" className="w-4 h-4"/></button>
                                </div>
                                <button onClick={()=>{onAddToCart(product, qty); onBack();}} className="flex-1 bg-slate-800 text-white font-bold rounded-xl">ë‹´ê¸°</button>
                            </div>
                        </div>
                    </div>
                );
            };

            if (selectedProduct) return <ProductDetail product={selectedProduct} onBack={() => setSelectedProduct(null)} onAddToCart={addToCart} />;

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800">
                    <header className="sticky top-0 z-40 bg-white shadow-sm border-b h-16 flex items-center justify-between px-4">
                        <div className="flex items-center gap-2 font-bold cursor-pointer" onClick={()=>setSelectedCategory("ì „ì²´")}>
                            <div className="bg-slate-800 w-8 h-8 rounded text-white flex items-center justify-center">S</div>
                            <span className="hidden sm:block">SJ Innovation</span>
                        </div>
                        <div className="flex-1 max-w-lg mx-4 relative hidden sm:block">
                            <input type="text" placeholder="ê²€ìƒ‰..." className="w-full bg-slate-100 rounded-full py-2 pl-10 text-sm" value={searchTerm} onChange={e=>setSearchTerm(e.target.value)} />
                            <Icon name="Search" className="absolute left-3 top-2.5 text-slate-400 w-4 h-4" />
                        </div>
                        <div className="flex items-center gap-4">
                            <button onClick={()=>setIsCartOpen(true)} className="relative"><Icon name="Boxes" />{cart.length>0 && <span className="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center">{cart.length}</span>}</button>
                            <button onClick={onLogout}><Icon name="LogOut" /></button>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 py-8">
                        <div className="flex overflow-x-auto pb-4 gap-2 mb-4 scrollbar-hide">
                            {CATEGORIES.map(cat => (
                                <button key={cat} onClick={() => setSelectedCategory(cat)} className={`px-5 py-2 rounded-full text-sm font-bold whitespace-nowrap border ${selectedCategory === cat ? "bg-slate-800 text-white" : "bg-white"}`}>{cat}</button>
                            ))}
                        </div>

                        <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                            {filteredProducts.map(p => (
                                <div key={p.id} onClick={() => setSelectedProduct(p)} className="bg-white rounded-xl shadow-sm border overflow-hidden cursor-pointer hover:shadow-lg transition">
                                    <div className="aspect-square bg-slate-100 flex items-center justify-center text-6xl">{p.image}</div>
                                    <div className="p-4">
                                        <div className="text-xs text-slate-400 mb-1">{p.category}</div>
                                        <h3 className="font-bold line-clamp-1 mb-2">{p.name}</h3>
                                        <div className="flex justify-between items-end">
                                            <span className="font-bold">â‚©{formatPrice(p.price)}</span>
                                            <span className="text-xs bg-slate-100 px-2 py-1 rounded">ì¬ê³  {p.stock}</span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>

                    {isCartOpen && (
                        <div className="fixed inset-0 z-50 flex justify-end">
                            <div className="absolute inset-0 bg-black/30" onClick={()=>setIsCartOpen(false)}></div>
                            <div className="bg-white w-full max-w-md h-full shadow-2xl p-4 flex flex-col animate-in slide-in-from-right">
                                <div className="flex justify-between mb-4 font-bold text-lg"><h2>ë°œì£¼ ëª©ë¡</h2><button onClick={()=>setIsCartOpen(false)}><Icon name="X" /></button></div>
                                <div className="flex-1 overflow-y-auto space-y-4">
                                    {cart.map((item, idx) => (
                                        <div key={idx} className="flex gap-4 border-b pb-4">
                                            <div className="w-16 h-16 bg-slate-100 flex items-center justify-center text-2xl rounded">{item.image}</div>
                                            <div><div className="font-bold">{item.name}</div><div className="text-sm">â‚©{formatPrice(item.price)} x {item.quantity}</div></div>
                                        </div>
                                    ))}
                                </div>
                                <button className="w-full bg-slate-800 text-white py-4 rounded-xl font-bold mt-4">ë°œì£¼ ì‹ ì²­í•˜ê¸°</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- [ìµœìƒìœ„ App] ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [products, setProducts] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const initData = async () => {
                    if (!window.fs) return;
                    const { collection, getDocs, doc, setDoc } = window.fs;
                    try {
                        const snap = await getDocs(collection(window.db, "products"));
                        if (snap.empty) {
                            await Promise.all(INITIAL_PRODUCTS.map(p => setDoc(doc(window.db, "products", p.id), p)));
                            setProducts(INITIAL_PRODUCTS);
                        } else {
                            setProducts(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                        }
                    } catch(e) { console.error(e); }
                };

                const timer = setTimeout(() => {
                    if (window.auth) {
                        initData();
                        window.auth.onAuthStateChanged(u => {
                            if (!isAdmin) setUser(u);
                            setLoading(false);
                        });
                    }
                }, 1000);
                return () => clearTimeout(timer);
            }, [isAdmin]);

            const handleAdminLogin = () => { setIsAdmin(true); setUser({ email: 'admin' }); };
            const handleLogout = () => {
                if(isAdmin) { setIsAdmin(false); setUser(null); }
                else window.logOut(window.auth);
            };

            if (loading) return <div className="h-screen flex items-center justify-center text-slate-400 font-bold">ì‹œìŠ¤í…œ ì—°ê²°ì¤‘...</div>;
            if (isAdmin) return <AdminPage products={products} onLogout={handleLogout} />;
            if (user) return <ShopPage products={products} user={user} onLogout={handleLogout} />;
            return <LoginPage onAdminLogin={handleAdminLogin} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
