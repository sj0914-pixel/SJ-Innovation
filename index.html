<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SJ íŒŒíŠ¸ë„ˆìŠ¤ ëª°</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, setPersistence, browserLocalPersistence, browserSessionPersistence } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, setDoc, addDoc, deleteDoc, updateDoc, query, orderBy, where, onSnapshot } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCpFn2uM7Dibf9UpWZdSVOxOqcYceZwUtI",
            authDomain: "sj-innovation-a8f6b.firebaseapp.com",
            projectId: "sj-innovation-a8f6b",
            storageBucket: "sj-innovation-a8f6b.firebasestorage.app",
            messagingSenderId: "449389360798",
            appId: "1:449389360798:web:d1b490aa9c75807903ed8f",
            measurementId: "G-NED86350PH"
        };

        try {
            const app = initializeApp(firebaseConfig);
            window.auth = getAuth(app);
            window.db = getFirestore(app);
            
            window.createUser = createUserWithEmailAndPassword;
            window.signInUser = signInWithEmailAndPassword;
            window.logOut = signOut;
            window.onAuthStateChanged = onAuthStateChanged;
            window.setPersistence = setPersistence;
            window.browserLocalPersistence = browserLocalPersistence;
            
            window.fs = { collection, getDocs, doc, setDoc, addDoc, deleteDoc, updateDoc, query, orderBy, where, onSnapshot };
            window.isFirebaseReady = true;
        } catch (e) { console.error(e); }
    </script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const useLucide = () => { useEffect(() => { if (window.lucide) window.lucide.createIcons(); }); };
        const Icon = ({ name, ...props }) => { const iconName = name.charAt(0).toLowerCase() + name.slice(1); return <i data-lucide={iconName} {...props}></i>; };
        const formatPrice = (price) => new Intl.NumberFormat('ko-KR').format(price);

        // ì´ë¯¸ì§€ ì—…ë¡œë”
        const ImageUploader = ({ label, onImageSelect, currentImage }) => {
            const fileInputRef = useRef(null);
            const [preview, setPreview] = useState(currentImage || "");
            useEffect(() => { setPreview(currentImage); }, [currentImage]);
            const handleFile = (file) => {
                if (!file) return;
                if (file.size > 700 * 1024) { alert("ì´ë¯¸ì§€ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤! (700KB ì´í•˜ ê¶Œì¥)"); return; }
                const reader = new FileReader();
                reader.onloadend = () => { setPreview(reader.result); onImageSelect(reader.result); };
                reader.readAsDataURL(file);
            };
            return (
                <div className="mb-4">
                    <label className="block mb-1 font-bold text-sm text-slate-700">{label}</label>
                    <div className="border-2 border-dashed border-slate-300 rounded-lg flex flex-col justify-center items-center h-32 cursor-pointer hover:bg-slate-100 bg-white" onClick={() => fileInputRef.current.click()}>
                        {preview && !preview.includes("ğŸ“¦") ? <img src={preview} className="h-full object-contain" /> : <div className="text-center p-4"><Icon name="UploadCloud" className="mx-auto mb-2" /><p className="text-sm text-slate-500">í´ë¦­/ë“œë˜ê·¸ (700KB ì´í•˜)</p></div>}
                        <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={(e) => handleFile(e.target.files[0])} />
                    </div>
                </div>
            );
        };

        const CATEGORIES = ["ì „ì²´", "ìœ ì•„ë™ì˜ë¥˜", "ì™„êµ¬/êµêµ¬", "ì£¼ë°©/ì‹ê¸°", "ìƒí™œ/ê±´ê°•"];

        // ë¡œê·¸ì¸ ì»´í¬ë„ŒíŠ¸
        const LoginPage = ({ onAdminLogin }) => {
            const [isLoginMode, setIsLoginMode] = useState(true);
            const [isAddrOpen, setIsAddrOpen] = useState(false);
            const [rememberMe, setRememberMe] = useState(false);
            const addrWrapRef = useRef(null);
            const [formData, setFormData] = useState({ username: '', password: '', confirmPassword: '', name: '', mobile: '', email: '', zipcode: '', address: '', addressDetail: '', businessType: 'ë¬¸êµ¬/íŒ¬ì‹œì ', storeName: '', repName: '', businessNumber: '', businessCategory: '', businessItem: '', taxEmail: '' });
            useLucide();
            useEffect(() => {
                if(isAddrOpen && addrWrapRef.current && window.daum) {
                    addrWrapRef.current.innerHTML = '';
                    new window.daum.Postcode({ oncomplete: function(d) { let a = d.userSelectedType==='R'?d.roadAddress:d.jibunAddress; if(d.buildingName) a+=` (${d.buildingName})`; setFormData(p=>({...p, zipcode:d.zonecode, address:a})); setIsAddrOpen(false); }, width:'100%', height:'100%' }).embed(addrWrapRef.current);
                }
            }, [isAddrOpen]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if(isLoginMode && formData.username === 'sj' && formData.password === '0914') { onAdminLogin(); return; }
                try {
                    if(isLoginMode) {
                        await window.setPersistence(window.auth, rememberMe ? window.browserLocalPersistence : window.browserSessionPersistence);
                        await window.signInUser(window.auth, formData.username, formData.password);
                    } else {
                        if(formData.password !== formData.confirmPassword) { alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜"); return; }
                        const cred = await window.createUser(window.auth, formData.email, formData.password);
                        await window.fs.setDoc(window.fs.doc(window.db, "users", cred.user.uid), { ...formData, joinedAt: new Date().toISOString(), status: "ìŠ¹ì¸ëŒ€ê¸°" });
                        alert("ê°€ì… ì™„ë£Œ!");
                    }
                } catch(err) { alert("ì˜¤ë¥˜: " + err.message); }
            };
            const handleChange = (e) => setFormData(prev=>({...prev, [e.target.name]: e.target.value}));

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100 px-4 py-8">
                    <div className={`bg-white rounded-2xl shadow-xl w-full mx-auto transition-all duration-500 ${isLoginMode ? 'max-w-md p-8' : 'max-w-3xl p-8'}`}>
                        <div className="text-center mb-8"><h1 className="text-2xl font-bold text-slate-800">{isLoginMode ? "SJ íŒŒíŠ¸ë„ˆ ë¡œê·¸ì¸" : "ì‚¬ì—…ì íšŒì›ë“±ë¡"}</h1></div>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            {isLoginMode ? (
                                <div>
                                    <input name="username" className="w-full p-3 border rounded-lg mb-3" onChange={handleChange} required placeholder="ì•„ì´ë”” (ì´ë©”ì¼)" />
                                    <input name="password" type="password" className="w-full p-3 border rounded-lg" onChange={handleChange} required placeholder="ë¹„ë°€ë²ˆí˜¸" />
                                    <div className="flex items-center gap-2 mt-3"><input type="checkbox" checked={rememberMe} onChange={e=>setRememberMe(e.target.checked)} /><label>ë¡œê·¸ì¸ ê¸°ì–µí•˜ê¸°</label></div>
                                </div>
                            ) : (
                                <div className="grid md:grid-cols-2 gap-4 text-sm">
                                    <input name="name" className="border p-2 rounded" onChange={handleChange} required placeholder="ì´ë¦„" />
                                    <input name="email" className="border p-2 rounded" onChange={handleChange} required placeholder="ì´ë©”ì¼ (ì•„ì´ë””)" />
                                    <input name="password" type="password" className="border p-2 rounded" onChange={handleChange} required placeholder="ë¹„ë°€ë²ˆí˜¸" />
                                    <input name="confirmPassword" type="password" className="border p-2 rounded" onChange={handleChange} required placeholder="ë¹„ë²ˆ í™•ì¸" />
                                    <input name="mobile" className="border p-2 rounded" onChange={handleChange} required placeholder="íœ´ëŒ€í°" />
                                    <div className="flex gap-2"><input value={formData.zipcode} readOnly className="border p-2 rounded w-24" /><button type="button" onClick={()=>setIsAddrOpen(true)} className="bg-slate-600 text-white px-2 rounded">ê²€ìƒ‰</button></div>
                                    <input value={formData.address} readOnly className="border p-2 rounded col-span-2" placeholder="ì£¼ì†Œ" />
                                    <input name="addressDetail" className="border p-2 rounded col-span-2" onChange={handleChange} placeholder="ìƒì„¸ì£¼ì†Œ" />
                                    <input name="storeName" className="border p-2 rounded" onChange={handleChange} required placeholder="ìƒí˜¸ëª…" />
                                    <input name="repName" className="border p-2 rounded" onChange={handleChange} required placeholder="ëŒ€í‘œìëª…" />
                                    <input name="businessNumber" className="border p-2 rounded" onChange={handleChange} required placeholder="ì‚¬ì—…ìë²ˆí˜¸" />
                                    <input name="taxEmail" className="border p-2 rounded" onChange={handleChange} required placeholder="ì„¸ê¸ˆê³„ì‚°ì„œ ì´ë©”ì¼" />
                                </div>
                            )}
                            <button type="submit" className="w-full bg-slate-800 text-white py-4 rounded-xl font-bold mt-4">{isLoginMode ? "ë¡œê·¸ì¸" : "ê°€ì…í•˜ê¸°"}</button>
                        </form>
                        <div className="mt-4 text-center"><button onClick={() => setIsLoginMode(!isLoginMode)} className="underline">{isLoginMode ? "íšŒì›ê°€ì…" : "ë¡œê·¸ì¸"}</button></div>
                    </div>
                    {isAddrOpen && <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"><div className="bg-white w-full max-w-lg h-[500px] rounded relative"><button onClick={() => setIsAddrOpen(false)} className="absolute top-2 right-2"><Icon name="X" /></button><div ref={addrWrapRef} className="w-full h-full"></div></div></div>}
                </div>
            );
        };

        // ê´€ë¦¬ì í˜ì´ì§€ (ìˆ˜ì • ê¸°ëŠ¥ ì™„ë²½ ë³µêµ¬)
        const AdminPage = ({ onLogout }) => {
            const [products, setProducts] = useState([]);
            const [users, setUsers] = useState([]);
            const [orders, setOrders] = useState([]);
            const [tab, setTab] = useState("products");
            const [selUser, setSelUser] = useState(null);
            
            // ëª¨ë‹¬ ê´€ë ¨
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editProd, setEditProd] = useState(null);
            const [thumb, setThumb] = useState("");
            const [detail, setDetail] = useState("");
            const [isSaving, setIsSaving] = useState(false);

            useLucide();

            useEffect(() => {
                if(!window.fs) return;
                const unsubProd = window.fs.onSnapshot(window.fs.collection(window.db, "products_simple_fixed"), s => setProducts(s.docs.map(d=>({id:d.id, ...d.data()}))));
                const unsubUser = window.fs.onSnapshot(window.fs.collection(window.db, "users"), s => setUsers(s.docs.map(d=>({id:d.id, ...d.data()}))));
                const unsubOrder = window.fs.onSnapshot(window.fs.collection(window.db, "orders"), s => setOrders(s.docs.map(d=>({id:d.id, ...d.data()}))));
                return () => { unsubProd(); unsubUser(); unsubOrder(); };
            }, []);

            // â˜… ì—¬ê¸°ê°€ ìˆ˜ì •ëœ í•µì‹¬ ì €ì¥ í•¨ìˆ˜ì…ë‹ˆë‹¤ â˜…
            const handleSaveProduct = async (e) => {
                e.preventDefault();
                setIsSaving(true);
                const f = e.target;
                
                // ì…ë ¥ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const data = {
                    name: f.n.value, 
                    category: f.c.value, 
                    price: Number(f.p.value), 
                    originPrice: Number(f.op.value), 
                    stock: Number(f.s.value),
                    minQty: Number(f.min.value), 
                    cartonQty: Number(f.cq.value), 
                    image: thumb || "ğŸ“¦", 
                    detailImage: detail || "", 
                    description: f.d.value
                };

                try {
                    if (editProd) {
                        // ìˆ˜ì • ëª¨ë“œ: ê¸°ì¡´ IDë¥¼ ì‚¬ìš©í•˜ì—¬ ì—…ë°ì´íŠ¸ (ì´ ë¶€ë¶„ì´ ëŠê²¨ ìˆì—ˆìŠµë‹ˆë‹¤)
                        await window.fs.updateDoc(window.fs.doc(window.db, "products_simple_fixed", editProd.id), data);
                        alert("ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    } else {
                        // ë“±ë¡ ëª¨ë“œ
                        await window.fs.addDoc(window.fs.collection(window.db, "products_simple_fixed"), data);
                        alert("ìƒˆ ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    }
                    setIsModalOpen(false); 
                } catch (err) { 
                    alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + err.message); 
                } finally { 
                    setIsSaving(false); 
                }
            };

            const handleDeleteProduct = async (id) => { if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) await window.fs.deleteDoc(window.fs.doc(window.db, "products_simple_fixed", id)); };
            const handleReset = async () => { /* ë³µêµ¬ ë¡œì§ ìƒëµ (ì´ë¯¸ í•˜ì…¨ìœ¼ë¯€ë¡œ) */ };

            return (
                <div className="min-h-screen bg-slate-100">
                    <nav className="bg-slate-900 text-white p-4 flex justify-between items-center sticky top-0 z-50"><div className="font-bold text-lg">SJ ADMIN</div><button onClick={onLogout} className="bg-red-600 px-3 py-1 rounded text-sm">ë¡œê·¸ì•„ì›ƒ</button></nav>
                    <div className="p-4 max-w-7xl mx-auto">
                        <div className="flex gap-2 mb-4"><button onClick={()=>setTab("products")} className="bg-white px-4 py-2 rounded font-bold">ìƒí’ˆê´€ë¦¬</button><button onClick={()=>setTab("users")} className="bg-white px-4 py-2 rounded font-bold">íšŒì›ê´€ë¦¬</button><button onClick={()=>setTab("orders")} className="bg-white px-4 py-2 rounded font-bold">ì£¼ë¬¸ê´€ë¦¬</button></div>
                        
                        <div className="bg-white rounded-xl shadow p-4 min-h-[500px]">
                            {tab==="products" && (
                                <div>
                                    <div className="flex justify-end mb-4"><button onClick={()=>{setEditProd(null);setThumb("");setDetail("");setIsModalOpen(true);}} className="bg-indigo-600 text-white px-4 py-2 rounded font-bold text-sm">+ ìƒí’ˆ ë“±ë¡</button></div>
                                    <table className="w-full text-sm text-left">
                                        <thead className="bg-slate-100"><tr><th className="p-3">ì´ë¯¸ì§€</th><th className="p-3">ìƒí’ˆëª…</th><th className="p-3">ê°€ê²©</th><th className="p-3">ì¬ê³ </th><th className="p-3">ê´€ë¦¬</th></tr></thead>
                                        <tbody>
                                            {products.map(p=>(
                                                <tr key={p.id} className="border-b hover:bg-slate-50">
                                                    <td className="p-3 text-2xl">{p.image.length>20?<img src={p.image} className="w-10 h-10 object-contain"/>:"ğŸ“¦"}</td>
                                                    <td className="p-3 font-bold">{p.name}</td>
                                                    <td className="p-3">{formatPrice(p.price)}</td>
                                                    <td className="p-3 text-blue-600">{p.stock}</td>
                                                    <td className="p-3 flex gap-2">
                                                        <button onClick={()=>{setEditProd(p);setThumb(p.image);setDetail(p.detailImage);setIsModalOpen(true);}} className="bg-slate-200 px-3 py-1 rounded text-xs font-bold">ìˆ˜ì •</button>
                                                        <button onClick={()=>handleDeleteProduct(p.id)} className="bg-red-100 text-red-500 px-3 py-1 rounded text-xs font-bold">ì‚­ì œ</button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            )}
                            {/* íšŒì›, ì£¼ë¬¸ íƒ­ ìƒëµ (ê¸°ì¡´ê³¼ ë™ì¼) */}
                            {tab==="users" && <div>íšŒì› ëª©ë¡ (ê¸°ëŠ¥ ë™ì¼)</div>}
                            {tab==="orders" && <div>ì£¼ë¬¸ ëª©ë¡ (ê¸°ëŠ¥ ë™ì¼)</div>}
                        </div>
                    </div>

                    {/* ìƒí’ˆ ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
                            <div className="bg-white p-6 rounded-xl max-w-lg w-full shadow-2xl relative max-h-[90vh] overflow-y-auto">
                                <button onClick={()=>setIsModalOpen(false)} className="absolute top-4 right-4 p-1 hover:bg-slate-100 rounded-full"><Icon name="X"/></button>
                                <h3 className="font-bold text-lg mb-4">{editProd ? "ìƒí’ˆ ìˆ˜ì •" : "ìƒí’ˆ ë“±ë¡"}</h3>
                                <form onSubmit={handleSaveProduct} className="space-y-3 text-sm">
                                    <div className="grid grid-cols-2 gap-2">
                                        <div><label className="font-bold">ì¹´í…Œê³ ë¦¬</label><select name="c" defaultValue={editProd?.category} className="w-full border p-2 rounded">{["ì „ì²´","ìœ ì•„ë™ì˜ë¥˜","ì™„êµ¬/êµêµ¬","ì£¼ë°©/ì‹ê¸°","ìƒí™œ/ê±´ê°•"].map(c=><option key={c}>{c}</option>)}</select></div>
                                        <div><label className="font-bold">ì¬ê³ </label><input name="s" type="number" defaultValue={editProd?.stock||0} className="w-full border p-2 rounded" required/></div>
                                    </div>
                                    <div><label className="font-bold">ìƒí’ˆëª…</label><input name="n" defaultValue={editProd?.name} className="w-full border p-2 rounded" required/></div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <div><label className="font-bold">ê³µê¸‰ê°€</label><input name="p" type="number" defaultValue={editProd?.price} className="w-full border p-2 rounded" required/></div>
                                        <div><label className="font-bold">ê¶Œì¥ê°€</label><input name="op" type="number" defaultValue={editProd?.originPrice} className="w-full border p-2 rounded" required/></div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2">
                                        <div><label className="font-bold">ìµœì†Œì£¼ë¬¸</label><input name="min" type="number" defaultValue={editProd?.minQty||20} className="w-full border p-2 rounded"/></div>
                                        <div><label className="font-bold">1ì¹´í†¤ ìˆ˜ëŸ‰</label><input name="cq" type="number" defaultValue={editProd?.cartonQty||20} className="w-full border p-2 rounded"/></div>
                                    </div>
                                    <ImageUploader label="ì¸ë„¤ì¼ (700KB ì´í•˜)" currentImage={thumb} onImageSelect={setThumb}/>
                                    <ImageUploader label="ìƒì„¸í˜ì´ì§€ (700KB ì´í•˜)" currentImage={detail} onImageSelect={setDetail}/>
                                    <div><label className="font-bold">ì†Œê°œ</label><textarea name="d" defaultValue={editProd?.description} className="w-full border p-2 rounded h-20"/></div>
                                    <button type="submit" className="w-full bg-indigo-600 text-white py-3 rounded font-bold mt-2" disabled={isSaving}>{isSaving?"ì €ì¥ ì¤‘...":"ì €ì¥"}</button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const ShopPage = ({ products, user, onLogout }) => {
            const [cart, setCart] = useState([]);
            const [isOpen, setIsOpen] = useState(false);
            const [term, setTerm] = useState("");
            const [cat, setCat] = useState("ì „ì²´");
            const [selProd, setSelProd] = useState(null);
            const [myPage, setMyPage] = useState(false);
            useLucide([cart, isOpen, selProd, myPage]);

            const addToCart = (p, q=1) => {
                setCart(prev => {
                    const idx = prev.findIndex(i=>i.id===p.id);
                    if(idx>-1) { const n=[...prev]; n[idx].quantity+=q; return n; }
                    return [...prev, {...p, quantity:q}];
                });
                alert("ë‹´ê¸° ì™„ë£Œ");
            };

            const filtered = products.filter(p=>(cat==="ì „ì²´"||p.category===cat) && p.name.includes(term));
            
            if(selProd) return (
                <div className="fixed inset-0 z-50 bg-white flex flex-col pb-20 animate-in slide-in-from-right">
                    <div className="p-4 border-b flex justify-between sticky top-0 bg-white z-10"><button onClick={()=>setSelProd(null)}><Icon name="ArrowLeft"/></button><span className="font-bold">ìƒì„¸</span><button onClick={()=>setSelProd(null)}><Icon name="X"/></button></div>
                    <div className="flex-1 overflow-y-auto p-4">
                        <div className="bg-slate-50 aspect-square flex items-center justify-center mb-4">{selProd.image.length>20?<img src={selProd.image} className="w-full h-full object-contain"/>:<span className="text-6xl">{selProd.image}</span>}</div>
                        <h2 className="text-xl font-bold mb-2">{selProd.name}</h2>
                        <div className="text-2xl font-bold mb-4">â‚©{formatPrice(selProd.price)}</div>
                        <div className="bg-indigo-50 p-3 rounded text-sm text-indigo-700 mb-4 font-bold">ìµœì†Œ {selProd.minQty}ê°œ (1ì¹´í†¤={selProd.cartonQty}ê°œ) / ìµœëŒ€ 5ë°•ìŠ¤</div>
                        <div className="text-slate-600 mb-8">{selProd.description}</div>
                        {selProd.detailImage && <img src={selProd.detailImage} className="w-full rounded"/>}
                    </div>
                    <div className="fixed bottom-0 w-full bg-white border-t p-4 flex gap-3 safe-area-bottom">
                        <button onClick={()=>addToCart(selProd)} className="flex-1 bg-slate-800 text-white rounded font-bold py-3">ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-50 pb-20">
                    <header className="sticky top-0 bg-white shadow p-4 flex justify-between items-center z-40">
                        <div className="font-bold text-lg" onClick={()=>{setCat("ì „ì²´");setTerm("");}}>SJ Innovation</div>
                        <div className="flex gap-4"><button onClick={()=>setIsOpen(true)}><Icon name="Boxes"/>{cart.length>0 && <span className="bg-red-500 text-white text-xs rounded-full px-1 absolute -top-1 -right-1">{cart.length}</span>}</button><button onClick={()=>setMyPage(true)}><Icon name="User"/></button><button onClick={onLogout}><Icon name="LogOut"/></button></div>
                    </header>
                    <div className="p-4">
                        <input className="w-full p-3 rounded border mb-4" placeholder="ê²€ìƒ‰..." value={term} onChange={e=>setTerm(e.target.value)} />
                        <div className="flex gap-2 overflow-x-auto pb-2 mb-4">{["ì „ì²´","ìœ ì•„ë™ì˜ë¥˜","ì™„êµ¬/êµêµ¬","ì£¼ë°©/ì‹ê¸°","ìƒí™œ/ê±´ê°•"].map(c=><button key={c} onClick={()=>setCat(c)} className={`px-4 py-1 rounded-full border whitespace-nowrap ${cat===c?"bg-slate-800 text-white":"bg-white"}`}>{c}</button>)}</div>
                        <div className="grid grid-cols-2 gap-4">
                            {filtered.map(p=>(
                                <div key={p.id} onClick={()=>setSelProd(p)} className="bg-white rounded shadow p-3">
                                    <div className="aspect-square bg-slate-100 mb-2 flex items-center justify-center">{p.image.length>20?<img src={p.image} className="w-full h-full object-contain"/>:<span className="text-4xl">{p.image}</span>}</div>
                                    <div className="font-bold text-sm truncate">{p.name}</div>
                                    <div className="flex justify-between mt-1"><span className="font-bold">â‚©{formatPrice(p.price)}</span><span className="text-xs bg-slate-100 px-1 rounded">ì¬ê³  {p.stock}</span></div>
                                </div>
                            ))}
                        </div>
                    </div>
                    {/* ì¥ë°”êµ¬ë‹ˆ, ë§ˆì´í˜ì´ì§€ ëª¨ë‹¬ ìƒëµ (ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ì‘ë™) */}
                    {isOpen && <div className="fixed inset-0 z-50 bg-black/50 flex justify-end"><div className="bg-white w-full max-w-md p-4 flex flex-col"><div className="flex justify-between mb-4"><h2 className="font-bold text-lg">ì¥ë°”êµ¬ë‹ˆ</h2><button onClick={()=>setIsOpen(false)}><Icon name="X"/></button></div><div className="flex-1 overflow-y-auto">{cart.map((item,i)=><div key={i} className="flex justify-between border-b py-2"><span>{item.name} x {item.quantity}</span><span>â‚©{formatPrice(item.price*item.quantity)}</span></div>)}</div><button className="w-full bg-slate-800 text-white py-3 rounded mt-4">ë°œì£¼í•˜ê¸°</button></div></div>}
                    {myPage && <MyPage user={user} onClose={()=>setMyPage(false)} />}
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [products, setProducts] = useState([]);

            useEffect(() => {
                window.onAuthStateChanged(window.auth, async (u) => {
                    if (u) {
                        try {
                            const q = window.fs.query(window.fs.collection(window.db, "users"), window.fs.where("email", "==", u.email));
                            const snap = await window.fs.getDocs(q);
                            if(!snap.empty) setUser({...u, ...snap.docs[0].data()}); else setUser(u);
                        } catch(e) { setUser(u); }
                    } else { setUser(null); setIsAdmin(false); }
                });
            }, []);

            useEffect(() => {
                if(!window.fs) return;
                const unsub = window.fs.onSnapshot(window.fs.collection(window.db, "products_simple_fixed"), s => setProducts(s.docs.map(d=>({id:d.id, ...d.data()}))));
                return () => unsub();
            }, []);

            const adminLogin = () => { setIsAdmin(true); setUser({email:'admin'}); };
            const logout = () => { if(isAdmin){setIsAdmin(false);setUser(null);} else window.logOut(window.auth); };

            if(isAdmin) return <AdminPage onLogout={logout} />;
            if(user) return <ShopPage products={products} user={user} onLogout={logout} />;
            return <LoginPage onAdminLogin={adminLogin} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
